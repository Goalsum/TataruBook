---
title: データインポートガイド
locale: jp
sidebar:
  nav: "japanese"
---
現在、電子決済が普及しており、銀行や証券会社、決済アプリなどの取引プラットフォームでは、通常、過去の**取引記録**を出力することが可能です。そのため、各取引を手動で記録する必要はほとんどありません。しかし、プラットフォームごとに形式が異なる取引記録をTataruBookに一括インポートする方法は、記帳効率に大きく影響を及ぼす重要な課題となっています。

本ページでは、取引記録データの変換およびインポートする方法を提供し、参考にしていただければ幸いです。

# 取引記録をExcelに変換する

取引プラットフォームから出力された**取引明細書**は、テキスト、CSVファイル、Excelファイル、PDFファイルなど、さまざまな形式で提供される場合があります。取引明細書がCSVファイルまたはExcelファイルの場合、このステップは省略できることが多いです。それ以外の場合は、まず取引明細書の内容をExcelテーブルに変換する必要があります。

Excelテーブルの内容は、以下の要件を満たす必要があります。

- 各行は１件の取引のみを表していること。
- 取引記録は時間順に昇順で並んでいること（特に同じ日に複数の取引がある場合、単に日付で並べ替えるだけでは正しい順序にならないことがあります）。

残念ながら、銀行の取引明細書や証券取引報告書は、PDF形式やHTML 形式で提供されることがよくあります。この場合、アカウント明細から取引記録を抽出し、Excel形式に変換する必要があります。このプロセスに固定された方法はありませんが、さまざまな解決策があります。正規表現やファイル変換ツール、オンラインサービスなどを利用することができます。Googleで「取引明細書をExcelに変換する」と検索すれば、この作業を行うための多くの手順が見つかります。

例としてのテーブルを以下に示します。この例は、クレジットカード取引明細書の一部を模したものです。実際のアカウント明細書は、この例とは異なる場合があります。列の数が増減したり、列の順序が異なることも考えられます。ただし、テーブルが上記の２つの要件を満たしていれば、後続の手順を適宜調整するだけで、インポートは最終的に完了させることができます。

| 決済日 | 支払日 | 利用内容 | 利用金額 |
|:-:|:-:|:-:|:-:|
| 21/07/23 | 20/07/23 | ラストスタンド | 32.55 |
| 28/07/23 | 27/07/23 | ラストスタンド | 45.45 |
| 05/08/23 | 04/08/23 | マンダヴィル・ゴールドソーサー | 690.00 |
| 15/08/23 | 14/08/23 | モーグリ銀行からの支払い | -150.00 |
| 15/08/23 | 14/08/23 | シャーレアン銀行からの支払い | -150.00 |
| 15/08/23 | 14/08/23 | シャーレアン銀行からの支払い | -150.00 |

この手順では、Excelのセルには余分なスペース、タブ、改行、その他の不要な文字が含まれていないか注意深く確認する必要があります。これらの文字が含まれていると、後続の処理手順が失敗する原因となる可能性があります。また、これらの文字は Excel上で表示されないため、問題の特定がより困難です。アカウント明細書を変換した後は、これらの余分な文字をできるだけ早く削除する必要があります。
{: .notice--warning}

# 再利用可能な変換テンプレートを作成する

新しいExcelファイルを作成し、最初のワークシートを`生データ`と命名します。そのワークシートに、前の手順で取得したデータを貼り付けてください。

このExcelファイルは、このデータ形式を処理するための**変換テンプレート**になります。以後、この形式のデータについては`生データ`のワークシートに貼り付けるだけで、変換が自動的に完了します。つまり、**本ページで説明しているほとんどの手順は、特定の取引プラットフォームから出力されたデータを初めて処理する際にのみ必要です。**変換テンプレートを一度作成してしまえば、今後同じようなデータを処理する際には、大部分の手順が自動的に実行されるようになります。

取引プラットフォームによってデータ形式が異なる場合があるため、通常それぞれのプラットフォームに対応した専用の変換テンプレートを作成する必要があります。

# パラメータを設定する

変換テンプレート内で、`生データ`の次に`パラメータ`という名前の新しいワークシートを作成します。

次に、`生データ`を観察し、各取引について、**取引相手のアカウントを決定するための情報を特定します**。前文の例では以下のようになります。

- `利用内容`という列の内容が`ラストスタンド`の場合、取引相手のアカウントは`飲食費用`という外部アカウントになります。
- `利用内容`という列の内容が`マンダヴィル・ゴールドソーサー`の場合、取引相手のアカウントは`娯楽費用`という外部アカウントになります。
- `利用内容`という列の内容が`モーグリ銀行からの支払い`の場合、取引相手のアカウントは`モーグリ銀行普通預金`という内部アカウントになります。
- `利用内容`という列の内容が`シャーレアン銀行からの支払い`の場合、取引相手のアカウントは`シャーレアン銀行`という内部アカウントになります。

これらのルールに基づいて、`利用内容`と取引相手のアカウントとの対応関係を次のように`パラメータ`というワークシートに入力します。

| ラストスタンド | 飲食費用 |
| マンダヴィル・ゴールドソーサー | 娯楽費用 |
| モーグル銀行からの支払い | モーグリ銀行普通預金 |
| シャーレアン銀行からの支払い | シャーレアン銀行普通預金 |

`生データ`に日々の消費や振り込みが多数含まれている場合、このステップの処理は、かなり個別化されたものになることがあります。たとえば、ある取引を`飲食費用`として判断するにはどうすればよいでしょうか。特定のレストランでほとんどの食事をしている場合、これらの取引記録は特定の列に同じ値が記録されている可能性があり、`パラメーター`ワークシートにその列の特徴と`飲食費用`との対応関係を追加することができます。しかし、この方法だけではすべてのデータを処理するには不十分であることが多いです。一部の特定の支出や収入については、手動での対応が必要になる場合があります。
{: .notice}

# 必要な情報を取得し変換する

`生データ`には、例の`決済日`など、データベースファイルにインポートする必要のない列が含まれている場合があります。当然ながら、必要だと判断した情報については[postings]({{ site.baseurl }}/tables_and_views_jp.html#postings)テーブルの`comment`フィールドに記入することも可能です。ただし、最も重要なのは、`生データ`から取引に関する重要な情報を取得することです。

変換テンプレートの`パラメータ`部分の後に、新しいワークシートを作成して`中間結果`と命名します。そのワークシートの最初の行に、以下の列名を記載します。

| trade_date | this_account | amount | other_account | comment | other_change |

次に、`生データ`の構造に基づいて、データを取得し変換するために、列ごとに関数を設計する必要があります。ここでは、ワークシートの2行目 (つまり、データ内容の最初の行) に記載する各セルの関数を例として説明します。

たとえば、`trade_date`は取引日を表します。`生データ`における取引日は`支払日`列 (列B) に記録されています。ただし、`生データ`の支払日は YYYYMMDD形式で記載されているため、これをExcelの日付形式に変換する必要があります。このために設計された関数は以下のようになります: `= DATE( CONCAT("20",RIGHT('生データ'!B2,2)),MID('生データ'!B2,4,2),LEFT('生データ'!B2,2))`。この関数では、文字列操作関数と日付関数を使用しています。なお、`生データ`の日付形式が例と異なる場合は、状況に応じて関数を適切に調整する必要があります。

`this_account`は、`生データ`ですべての取引が発生したアカウントを指します。つまり、取引プラットフォームに対応するアカウントです。本例では、そのアカウント名を`シャーレアン銀行クレジットカード`と仮定し、その名称を`this_account`列に入力します。`this_account`の値はすべての取引が同一であるため、関数を使用する必要はありません。

異なる家族が同一の証券会社で口座を開設している場合など、同じ取引プラットフォームに複数のアカウントが存在する場合は、これらのアカウントが生成する取引記録は同一のデータ形式となります。そのため、一つの変換テンプレートを使用して処理することが可能です。このような場合、アカウント名を`パラメータ`ワークシートとしてParametersワークシートに記入し、`this_account`列で参照する方法をお勧めします。
{: .notice}

`amount`は、取引における`this_account`アカウントの残高変化額を表し、`生データ`の列Dに記載された`利用金額`が参照されます。クレジットカードの場合、利用金額は借入額を示すため、資産の変化額はアカウント明細書に記載された`利用金額`の反数になることに注意する必要があります。そのため、この列の関数は次のようになります: `=-'生データ'!D2`。

`other_account`は、取引における取引相手のアカウント名を示します。[パラメータを設定する]({{ site.baseurl }}/importing_data_jp.html#パラメータを設定する)の手順で設定されたパラメータに基づいて、この列の関数は次のようになります: `=VLOOKUP('生データ'!C2,Parameters!A:B,2,FALSE)`。

`comment`は、取引に関するコメントや説明を記載する列です。この列に入力されるデータの内容はユーザーの設定によって異なります。例では、`利用内容`を取得し、そのままcommentに直接入力します: `='生データ'!C2`。

`other_change`は、取引における取引相手のアカウントの残高変化額を示します。本例では、取引に関与する２つのアカウントが同じ資産を保持しているため、この列はすべて空欄になります。この場合、TataruBookは取引相手のアカウントの残高変化額を`amount`の反数として扱います。ただし、この条件を満たさない取引（たとえば株式取引など）がある場合は、`other_change`に情報を入力する必要があります。

| 列 | 関数 |
|:-:|:-:|
| trade_date  | `= DATE( CONCAT("20",RIGHT('生データ'!B2,2)),MID('生データ'!B2,4,2),LEFT('生データ'!B2,2))` |
| this_account | `シャーレアン銀行クレジットカード` |
| amount | `=-'生データ'!D2` |
| other_account | `= VLOOKUP( '生データ'!C2,パラメータ!A:B,2,FALSE)` |
| comment | `='生データ'!C2` |
| other_change | `(空欄)` |

データ内容の最初の行にすべての関数を入力した後、Excelのオートフィル機能を使用して他の行にも対応する関数を適用することで、次のように計算結果を取得できます。

| trade_date | this_account | amount | other_account | comment | other_change |
|:-:|:-:|:-:|:-:|:-:|:-:|
| 2023/7/20 | シャーレアン銀行クレジットカード | -32.55 | 飲食費用 | ラストスタンド | |
| 2023/7/27 | シャーレアン銀行クレジットカード | -45.45 | 飲食費用 | ラストスタンド | |
| 2023/8/4 | シャーレアン銀行クレジットカード | -690 | エンターテインメント | マンダヴィル ゴールドソーサー | |
| 2023/8/14 | シャーレアン銀行クレジットカード | 150 | モーグリ銀行現在 | モーグル銀行からの支払い | |
| 2023/8/14 | シャーレアン銀行クレジットカード | 150 | シャーレアン銀行普通預金 | シャーレアン銀行からの支払い | |
| 2023/8/14 | シャーレアン銀行クレジットカード | 150 | シャーレアン銀行普通預金 | シャーレアン銀行からの支払い | |

このステップにおける関数の設計は、実際のデータ形式に依存するため、[Excel関数ファイル](https://support.microsoft.com/ja-jp/office/excel-%E9%96%A2%E6%95%B0-%E6%A9%9F%E8%83%BD%E5%88%A5-5f91f4e9-7b42-46d2-9bd1-63f26a86c0eb)を頻繁に参照する必要がある場合があります。Excelの関数に詳しくない場合は、検索エンジンを利用するか、AIに助けを求めることを検討してください。
{: .notice}

# 中間結果の正確性を確認する

ここでは、`中間結果`ワークシートのデータを手動で確認する必要があります。`生データ`に含まれる各取引は常に厳密に一貫したルールに従っているとは限らず、データに異常が発生する場合があるため、手動で確認し、適切に処理する必要があります。ただし、データを修正する際は、`生データ`のワークシートのみを変更し、`中間結果`のワークシートには手を加えないでください。そうしないと、既存の関数が破損し、変換テンプレートを再利用できなくなります。

# 元のアカウントと目的アカウントを選択する

変換テンプレートの`中間結果`の後ろに新しいワークシートを作成し、`最終結果`と命名します。そのワークシートの最初の行に、[postings]({{ site.baseurl }}/tables_and_views_jp.html#postings)テーブルのインポート要件に従い、以下の列名を記載します。

| posting_index | trade_date | src_account | src_change | dst_account | comment | dst_change |

`dst_change`は[posting_extras]({{ site.baseurl }}/tables_and_views_jp.html#posting_extras)テーブルのフィールドではなく、[postings]({{ site.baseurl }}/tables_and_views_jp.html#postings)テーブルのフィールドです。ただし、[関連テーブルに自動挿入する]({{ site.baseurl }}/commands_jp.html#自动插入关联表的记录)機能を利用することで、TataruBookは両方のテーブルに関連するデータを同時に挿入できるため、取引記録をインポートする際にこの列が必要です。
{: .notice}

`最終結果`において、`posting_index`列は空のままにしてください(理由については、[自動生成されたインデックス フィールド]({{ site.baseurl }}/commands_jp.html#自動生成されたインデックス フィールド)を参照してください)。また、`trade_date`列と`comment`列のデータは、中間結果に対応する列のデータをそのまま参照できます。`src_account`や`src_change`、`dst_account`、 `dst_change`の4列の内容は、各取引の**キャッシュフローの方向**に基づいて確定する必要があります。

`中間結果`を観察すると、`amount`の値がマイナスの場合、「src_account」(すなわち資金が流出するアカウント) は`this_account`、一方`dst_account `(すなわち資金が流入するアカウント) は`other_account`であることがわかります。逆に、`amount`列の値がプラスの場合、`src_account`は `other_account`、そして`dst_account`は `this_account`であることがわかります。つまり、取引の資金変動額の符号に基づき、２つのアカウントを交換する必要があるかどうかを判断する必要があります。

しかし、`amount`が$$ 0 $$の場合はどうなるでしょうか。本例では、`amount`が$$ 0 $$の取引はありませんが、実際に株式分割または株式併合が発生する場合、対応する取引で株式数のみが変動し、取引金額が$$ 0 $$になる可能性があります。これらのケースに対応するためには、変換テンプレートを次のように調整するのが最適です。すなわち、`amount`が$$ 0 $$の場合、`other_change`値がプラスであるかマイナスであるかに基づいてキャッシュフローの方向を決定します。

`中間結果`に`other_change`値が存在する場合、`src_change`列と`dst_change`列の計算方法は、`src_account`列と`dst_account`列の計算方法と似ており、`src_account`列の計算結果を基に、これらの２列の数値を交換するかどうかを判断できます。ただし、もし`中間結果`に`other_change`が空欄の場合、`最終結果`の`dst_change`列も空欄にしなければならなりません。そして、`src_change`については、`amount`的の値をそのまま使用するか、あるいは`amount`の反数を使用するかを決定する必要があります（`src_change`は常に$$ 0 $$以下であるため）。

このように、`最終結果`ワークシートの2行目 (すなわち、データ内容の最初の行)にある各列の関数は、以下次の通りです。

| 列 | 関数 |
|:-:|:-:|
| posting_index | |
| trade_date | `=中間結果!A2` |
| src_account | `=IF(中間結果!C2<0,中間結果!B2,IF(中間結果!C2>0,中間結果!D2,IF(中間結果!F2<0,中間結果!D2,中間結果!B2)))` |
| src_change | `=IF(中間結果!F2="",IF(中間結果!B2=C2,中間結果!C2,-中間結果!C2),IF(中間結果!B2=C2,中間結果!C2,中間結果!F2))` |
| dst_account | `=IF(中間結果!B2=C2,中間結果!D2,中間結果!B2)` |
| comment | `=中間結果!E2` |
| dst_change | `=IF(中間結果!F2="","",IF(中間結果!B2=C2,中間結果!F2,中間結果!C2))` |

これらの関数は少し複雑に見えるかもしれませんが**`最終結果`ワークシートの関数は、ほぼすべての変換テンプレートで再利用可能です**。`中間結果`ワークシートが、前の手順に厳密に従った固定形式で生成されている限り、`最終結果`ワークシートのすべての関数は、既存の変換テンプレートから直接コピーするだけで利用できます。

これらの関数をすべての行に入力すると、以下の計算結果が得られます。

| posting_index | trade_date | src_account | src_change | dst_account | comment | dst_change |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| | 2023/7/20 | シャーレアン銀行クレジットカード | -32.55 | 飲食費用 | ラストスタンド | |
| | 2023/7/27 | シャーレアン銀行クレジットカード | -45.45 | 飲食費用 | ラストスタンド | |
| | 2023/8/4 | シャーレアン銀行クレジットカード | -690 | エンターテインメント | マンダヴィル ゴールドソーサー | |
| | 2023/8/14 | モーグリ銀行現在 | -150 | シャーレアン銀行クレジットカード | モーグル銀行からの支払い | |
| | 2023/8/14 | シャーレアン銀行普通預金 | -150 | シャーレアン銀行クレジットカード | シャーレアン銀行からの支払い | |
| | 2023/8/14 | シャーレアン銀行普通預金 | -150 | シャーレアン銀行クレジットカード | シャーレアン銀行からの支払い | |

# インポート済みの取引記録を識別する

上記の例では、最後の３件の取引は、それぞれ別のアカウントから`シャーレアン銀行クレジットカード`アカウントへの振替です。通常、これらの取引記録は、取引関わるアカウントの両方の生データに存在します。たとえば、`シャーレアン銀行普通預金`の取引記録を先にインポートしていた場合、最後の２件の記録は、`シャーレアン銀行クレジットカード`の取引記録をインポートする前に、すでにデータベースファイル内に存在することになります。そのため、`シャーレアン銀行クレジットカード`の取引記録をインポートする際に、これらすでにインポートされた取引記録を識別し、データベースファイル内で重複が発生しないようにする必要があります。

ただし、この手順は必須ではありません。インポートする必要のある取引記録がデータベースファイル内に存在しないことが確実であれば、この手順を省略しても問題ありません。
{: .notice}

`最終結果`ワークシートの後に、新しいワークシートを作成し、`statements`と命名します。

次に、[export]({{ site.baseurl }}/commands_jp.html#export)コマンドを使用してデータベースファイルの[statements]({{ site.baseurl }}/tables_and_views_jp.html#statements)ビューの内容をエクスポートし、Excelで開きます。`src_name`列をフィルタリングして、`シャーレアン銀行普通預金`アカウントに関連する記録のみを表示します。その後、現在インポートしようとしている取引記録と重複する期間を確認し、この期間内の取引記録を`statements`ワークシートにコピー＆ペーストします。

次に、`中間結果`ワークシートと`statements`ワークシートの取引記録を**1 対 1 で照合する**必要があります。正しい記帳データは、以下のような照合結果を満たしている必要があります。

- ２件の記録が一致する場合、それらの取引日と取引金額は同じです。(注*)
- `statements`ワークシートの各記録に対して、`中間結果`ワークシートにはそれぞれ対応する唯一の記録があります。
- あるアカウントにおいて、この期間中の取引記録がすでにインポートされている場合、`中間結果`ワークシートでそのアカウントの各取引に対応する記録が存在し、`statements`ワークシートにもそれに対応する唯一の記録が含まれています。

注*: 現実の取引では、振込や送金が当日中に入金されなかったり、手数料などの影響で送金額と入金額が一致しない場合があります。このような場合、振込取引を手動で処理する必要があります。たとえば、1件の振込を手数料の支払いと実際の入金に分割して2つの取引として記録する方法があります。または、新たに「振込中」というアカウントを作成し、送金された金額をまず「振込中」アカウントに移動させ、その後、振込先のアカウントへ移動させる方法も考えられます。
{: .notice}

例の`statements`ワークシートを使用して、この一致手順を説明します。`statements`ワークシートの内容は以下の通りです。

| posting_index | trade_date | account_index | amount | target | comment | src_name | asset_index | is_external | target_name | balance |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| 102 | 2023/8/14 | 1 | 150 | 3 | 支払い | シャーレアン銀行普通預金 | 1 | 0 | シャーレアン銀行クレジットカード | 18450 |
| 103 | 2023/8/14 | 1 | 150 | 3 | 支払い | シャーレアン銀行普通預金 | 1 | 0 | シャーレアン銀行クレジットカード | 18300 |

この例では、`statements`に記録されている2件のデータ(2 行目と 3 行目) は、それぞれ`中間結果`の最後の2件と一致する必要があります。ただし、問題は`中間結果`にある最後の3件の記録の取引日と取引金額が同じである点です。そのため、通常のVLOOKUP関数を使用して一致させると、結果が不正確になる可能性があります。この問題を解決するために、以下のような特殊な関数を使用します。

まず、`中間結果`の現在最後の列である`other_change`(列 F)の右側に新しい列、`key_info` (列 G) を追加し、2 行目 (つまり、データの最初の行) に関数`=CONCAT(A2," ",C2)`を入力します。次に、`statements`に現在最後の列である`balance` (列 K) の右側にも、新しい列`key_info` (列 L) を追加し、2行目 (つまり、データの最初の行) に関数`=CONCAT(B2," ",D2)`を入力します。これらの二つの関数の目的は、後続の処理を容易にすることです。連結された日付が整数として表示される場合がありますが、Excel が日付を内部的に整数で表現しているためであり、後続の処理を与えません。

そして、`中間結果`の`key_info`列 (列 G)の右側に、新しい列`force_align`(列 H) を追加します。この列には関数が設定されておらず、初期状態では空欄です。ただし、必要に応じて、この列を使用して`statements`内の記録に手動で一致させることができます。

次に、`statements`の`key_info`列 (列 L)の右側に新しい列 (列 M) を追加し、列 Mの最初の行(ヘッダー行)に数字 `1`を入力します。2行目に、次の関数を入力します: `=IF(COUNTIF(中間結果!H:H,ROW())>0,MATCH(ROW(),中間結果!H:H,0),MATCH(L2,OFFSET(中間結果!G$1,M1,0,9999),0)+M1)`。

この関数は、まず`中間結果`の`force_align`列 (列 H)に手動で指定された一致する記録があるかどうかを確認します。一致する記録がある場合、その指定された記録を直接使用します。一致する記録がない場合、`中間結果`において、前回すでに一致した記録から下へ向かって、`statements`の該当行に一致する記録を検索します。この処理により、`中間結果`の複数の記録が同じ`statements`の記録に一致することを防ぐことが保証されます。

これらの関数をExcelのオートフィル機能を使用して、すべての行に入力します。すると、`statements`のM列で、2 行目と3 行目の記録にそれぞれ`5`と`6`を対応します。これらは、`中間結果`の第5条および第6条の記録です。

しかし、この対応関係は正しくありません。なぜなら、`中間結果`の5番目の記録はマッチングに含まれるべきではないからです（この取引はシャーレアン銀行の普通預金口座からのものではないためです）。ただし、この記録の取引日と取引額が、対応する必要のある記録と偶然一致していたため、先にマッチングされてしまいました。このような場合には手動での修正が必要です。`中間結果`ワークシートのセル H6 に数値`2`を入力することで、この記録が`statements`の2行目の記録に対応していることを指定します。

セルH6の内容を変更すると、`statements`の列 M の内容が更新されます。現在、2 件の記録がそれぞれ`6`と`7`に対応しており、マッチングは正確です。

最後に、`最終結果`のワークシートにおいて、現在の最後の列`dst_change`(列 G)の右側に新しい列`skip`(列 H) を追加し、2 行目に関数`=COUNTIF(statements!M:M,ROW())`を入力します。この関数は、その行の記録が`statements`内に対応するかどうかを示します。対応する場合は結果が`1`、しない場合は結果が`0`になります。この関数をすべての行に適用した後、フィルターを使用して結果が`0`の記録を抽出します。これらの記録は データベースファイル内に存在せず、インポートが必要な取引記録です。

上記の手順に従って、関連するワークシートに追加された列と各列の 2 行目に記載された関数をまとめると、次のようになります。

| ワークシート | 列ヘッダー | 列番号 | 関数 |
|:-:|:-:|:-:|:-:|
| 中間結果 | key_info | G | `=CONCAT(A2," ",C2)` |
| 中間結果 | force_align | H | 関数なし、手動で一致を指定するために使用 |
| statements | key_info | L | `=CONCAT(B2," ",D2)` |
| statements | 1 | M | `=IF(COUNTIF(中間結果!H:H,ROW())>0,MATCH(ROW(),中間結果!H:H,0),MATCH(L2,OFFSET(中間結果!G$1,M1,0,9999),0)+M1)` |
| 最终结果 | skip | H | `=COUNTIF(statements!M:M,ROW())` |

# csvファイルとして保存し、データをインポートする

`最終結果`ワークシートのデータは、すでにTataruBookの取引記録のインポート要件を満たしています。このデータをクリップボードにコピーし、[paste]({{ site.baseurl }}/commands_jp.html#paste)コマンドを使って挿入すれば、すべての作業は完了です。

ただし、注意が必要です。一部の取引には、TataruBook上でまだ作成されていないアカウントが関与している可能性があります。たとえば、これまで取引されたことのない株式が取引に関わる場合、[accounts]({{ site.baseurl }}/tables_and_views_jp.html#accounts)テーブルや[asset_types]({{ site.baseurl }}/tables_and_views_jp.html#asset_types)テーブルにその株式の情報が含まれていない可能性があり、これが原因でインポートが失敗する場合があります。ただし、TataruBookでは、記録のインポートに失敗した場合、自動的にロールバックが実行されるため、既存のデータに影響を与えることはありません。そのため、`postings.csv`ファイル全体を正常にインポートできるまで、複数回インポートを試みることができます。その際、失敗時のエラーメッセージに基づき、[accounts]({{ site.baseurl }}/tables_and_views_jp.html#accounts)テーブルや[asset_types]({{ site.baseurl }}/tables_and_views_jp.html#asset_types)テーブルに必要な情報を追加することで対応可能です。さらに、変換テンプレートの`中間結果`ワークシートにいくつかの新しい列を追加し、[accounts]({{ site.baseurl }}/tables_and_views_jp.html#accounts)テーブルや[asset_types]({{ site.baseurl }}/tables_and_views_jp.html#asset_types)テーブルに必要なフィールドを抽出して、インポート失敗時に不足している記録を補うことができます。